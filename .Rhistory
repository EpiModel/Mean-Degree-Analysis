filter(ptype == 1) %>%
group_by(AMIS_ID) %>%
summarise(main.avgduration = mean(duration)) %>%
right_join(ARTnet.wide.adjusted, by = "AMIS_ID")
ARTnet.wide.adjusted <- ARTnet.long.adjusted %>%
filter(RAI == 1 | IAI == 1 | ROI == 1 | IOI == 1) %>%
filter(ptype == 2) %>%
group_by(AMIS_ID) %>%
summarise(casl.avgduration = mean(duration)) %>%
right_join(ARTnet.wide.adjusted, by = "AMIS_ID")
# Scale up average main and causal duration to months and years
ARTnet.wide.adjusted <- ARTnet.wide.adjusted %>%
mutate(main.avgduration.mo = main.avgduration/4,
casl.avgduration.mo = casl.avgduration/4,
main.avgduration.yr = main.avgduration/52,
casl.avgduration.yr = casl.avgduration/52)
summary(ARTnet.wide.adjusted$main.avgduration)
summary(ARTnet.wide.adjusted$casl.avgduration)
summary(ARTnet.wide.adjusted$main.avgduration.mo)
summary(ARTnet.wide.adjusted$casl.avgduration.mo)
summary(ARTnet.wide.adjusted$main.avgduration.yr)
summary(ARTnet.wide.adjusted$casl.avgduration.yr)
ARTnet.wide.adjusted <-
ARTnet.long.adjusted %>%
filter(ptype == 1) %>%
group_by(AMIS_ID) %>%
summarise(n.main = n()) %>%
right_join(ARTnet.wide.adjusted, by = "AMIS_ID")
ARTnet.wide.adjusted <-
ARTnet.long.adjusted %>%
filter(ptype == 2) %>%
group_by(AMIS_ID) %>%
summarise(n.casl = n()) %>%
right_join(ARTnet.wide.adjusted, by = "AMIS_ID")
ARTnet.wide.adjusted <-
ARTnet.long.adjusted %>%
filter(ptype == 3) %>%
group_by(AMIS_ID) %>%
summarise(n.one = n()) %>%
right_join(ARTnet.wide.adjusted, by = "AMIS_ID")
# Replace NA's with 0
ARTnet.wide.adjusted$n.main[is.na(ARTnet.wide.adjusted$n.main)] <- 0
ARTnet.wide.adjusted$n.casl[is.na(ARTnet.wide.adjusted$n.casl)] <- 0
ARTnet.wide.adjusted$n.one[is.na(ARTnet.wide.adjusted$n.one)] <- 0
# Create variable for total partners reported
ARTnet.wide.adjusted$n.all <- ARTnet.wide.adjusted$n.main + ARTnet.wide.adjusted$n.casl + ARTnet.wide.adjusted$n.one
mean(ARTnet.wide.adjusted$main.mean)
mean(ARTnet.wide.adjusted$casl.mean)
ARTnet.wide.adjusted %>%
group_by(race.cat) %>%
summarize(mean.main = mean(main.mean),
mean.casl = mean(casl.mean))
ARTnet.wide.adjusted %>%
group_by(age.cat) %>%
summarize(mean.main = mean(main.mean),
mean.casl = mean(casl.mean))
ARTnet.wide.adjusted %>%
group_by(REGCODE) %>%
summarize(mean.main = mean(main.mean),
mean.casl = mean(casl.mean))
ARTnet.wide.adjusted %>%
group_by(HLEDUCAT_2) %>%
summarize(mean.main = mean(main.mean),
mean.casl = mean(casl.mean))
ARTnet.wide.adjusted %>%
group_by(HHINCOME_2) %>%
summarize(mean.main = mean(main.mean),
mean.casl = mean(casl.mean))
linear_reg <- function(outcome, exposure) {
linear <- lm(outcome ~ exposure, data = ARTnet.wide.adjusted)
s <- summary(linear)
r <- round(confint(linear), 2)
return(list(s,r))
}
linear_reg(ARTnet.wide.adjusted$main.slope, ARTnet.wide.adjusted$race.cat)
linear_reg(ARTnet.wide.adjusted$main.slope, ARTnet.wide.adjusted$age.cat)
linear_reg(ARTnet.wide.adjusted$main.slope, ARTnet.wide.adjusted$age)
linear_reg(ARTnet.wide.adjusted$main.slope, factor(ARTnet.wide.adjusted$HHINCOME_2))
linear_reg(ARTnet.wide.adjusted$main.slope, factor(ARTnet.wide.adjusted$HLEDUCAT_2))
linear_reg(ARTnet.wide.adjusted$main.slope, ARTnet.wide.adjusted$REGCODE)
linear_reg(ARTnet.wide.adjusted$main.slope, ARTnet.wide.adjusted$main.avgduration.yr)
linear_reg(ARTnet.wide.adjusted$main.slope, ARTnet.wide.adjusted$n.all)
linear_reg(ARTnet.wide.adjusted$casl.slope, ARTnet.wide.adjusted$race.cat)
linear_reg(ARTnet.wide.adjusted$casl.slope, ARTnet.wide.adjusted$age.cat)
linear_reg(ARTnet.wide.adjusted$casl.slope, ARTnet.wide.adjusted$age)
linear_reg(ARTnet.wide.adjusted$casl.slope, factor(ARTnet.wide.adjusted$HHINCOME_2))
linear_reg(ARTnet.wide.adjusted$casl.slope, factor(ARTnet.wide.adjusted$HLEDUCAT_2))
linear_reg(ARTnet.wide.adjusted$casl.slope, ARTnet.wide.adjusted$REGCODE)
linear_reg(ARTnet.wide.adjusted$casl.slope, ARTnet.wide.adjusted$main.avgduration.yr)
linear_reg(ARTnet.wide.adjusted$casl.slope, ARTnet.wide.adjusted$n.all)
summary(ARTnet.wide.adjusted$main.slope)
summary(ARTnet.wide.adjusted$casl.slope)
race.duration <- ARTnet.wide.adjusted %>%
group_by(race.cat) %>%
summarise(main.duration = mean(main.avgduration, na.rm = T))
ARTnet.long.adjusted %>%
filter(ptype == 1) %>%
group_by(race.cat) %>%
summarise(main.duration = mean(duration, na.rm = T))
ARTnet.long.adjusted %>%
filter(ptype == 2) %>%
group_by(race.cat) %>%
summarise(casl.duration = mean(duration, na.rm = T))
ARTnet.wide.adjusted %>%
group_by(race.cat) %>%
summarise(main.slope = mean(main.slope, na.rm = T),
casl.slope = mean(casl.slope, na.rm = T))
# Create Variable 'Age.Cat' to Create Age Categories for Ages
ARTnet.long.adjusted$age.cat <- ifelse(ARTnet.long.adjusted$age >= 15 & ARTnet.long.adjusted$age <= 24, '15-24',
ifelse(ARTnet.long.adjusted$age >= 25 & ARTnet.long.adjusted$age <= 34, '25-34',
ifelse(ARTnet.long.adjusted$age >= 35 & ARTnet.long.adjusted$age <= 44, '35-44',
ifelse(ARTnet.long.adjusted$age >= 45 & ARTnet.long.adjusted$age <= 54, '45-54',
ifelse(ARTnet.long.adjusted$age >= 55 & ARTnet.long.adjusted$age <= 65, '55-65',
ifelse(ARTnet.long.adjusted$age >= 66, '66+', 'unknown'))))))
ARTnet.long.adjusted %>%
filter(ptype == 1) %>%
group_by(age.cat) %>%
summarise(main.duration = mean(duration, na.rm = T))
ARTnet.long.adjusted %>%
filter(ptype == 2) %>%
group_by(age.cat) %>%
summarise(casl.duration = mean(duration, na.rm = T))
ARTnet.wide.adjusted %>%
group_by(age.cat) %>%
summarise(main.slope = mean(main.slope, na.rm = T),
casl.slope = mean(casl.slope, na.rm = T))
ARTnet.wide.adjusted %>%
group_by(HLEDUCAT_2) %>%
summarise(main.duration = mean(main.avgduration, na.rm = T),
casl.duration = mean(casl.avgduration, na.rm = T),
main.slope = mean(main.slope, na.rm = T),
casl.slope = mean(casl.slope, na.rm = T))
ARTnet.wide.adjusted %>%
group_by(HHINCOME_2) %>%
summarise(main.duration = mean(main.avgduration, na.rm = T),
casl.duration = mean(casl.avgduration, na.rm = T),
main.slope = mean(main.slope, na.rm = T),
casl.slope = mean(casl.slope, na.rm = T))
#check data
table(ARTnet.wide.adjusted$n.main, useNA = "always")
table(ARTnet.wide.adjusted$n.casl, useNA = "always")
table(ARTnet.wide.adjusted$n.one, useNA = "always")
table(ARTnet.wide.adjusted$n.all, useNA = "always")
table(ARTnet.wide.adjusted$main.slope, ARTnet.wide.adjusted$n.main)
table(ARTnet.wide.adjusted$main.slope, ARTnet.wide.adjusted$n.all)
table(ARTnet.wide.adjusted$main.slope, ARTnet.wide.adjusted$n.all)
table(ARTnet.wide.adjusted$casl.slope, ARTnet.wide.adjusted$n.all)
plot(jitter(ARTnet.wide.adjusted$main.slope,0.1)~jitter(ARTnet.wide.adjusted$n.all, 0.1),
xlab="Total Number of Male Partners Reported", ylab="Difference in Degree of Main Relationships at 12- and 0-Month Offsets")
plot(ARTnet.wide.adjusted$main.slope~ARTnet.wide.adjusted$M_MP12OANUM2,
xlab="Total Number of Male Partners", ylab="Difference in Degree of Main Relationships at 12- and 0-Month Offsets")
plot(jitter(ARTnet.wide.adjusted$casl.slope,0.1)~jitter(ARTnet.wide.adjusted$n.all, 0.1),
xlab="Total Number of Male Partners Reported", ylab="Difference in Degree of Casual Relationships at 12- and 0-Month Offsets")
plot(ARTnet.wide.adjusted$casl.slope~ARTnet.wide.adjusted$M_MP12OANUM2,
xlab="Total Number of Male Partners", ylab="Difference in Degree of Main Relationships at 12- and 0-Month Offsets")
plot(jitter(ARTnet.wide.adjusted$main.slope,0.1)~jitter(ARTnet.wide.adjusted$n.all, 0.1),
xlab="Total Number of Male Partners Reported", ylab="Difference in Degree of Main Relationships at 12- and 0-Month Offsets")
#plot main.slope and casl.slop with avg duration by year
plot(ARTnet.wide.adjusted$main.avgduration.yr, ARTnet.wide.adjusted$main.slope,
xlab="Average Duration of Main Relationships (Years)",
ylab="Difference in Degree of Main Relationships at 12- and 0-Month Offsets")
png('SF6.png', width=2048, height=1536, res=300)
plot(ARTnet.wide.adjusted$main.avgduration.yr, ARTnet.wide.adjusted$main.slope,
xlab="Average Duration of Main Relationships (Years)",
ylab="Difference in Degree of Main Relationships at 12- and 0-Month Offsets")
dev.off()
png('SF6.png', width=2048, height=1800, res=300)
plot(ARTnet.wide.adjusted$main.avgduration.yr, ARTnet.wide.adjusted$main.slope,
xlab="Average Duration of Main Relationships (Years)",
ylab="Difference in Degree of Main Relationships at 12- and 0-Month Offsets")
dev.off()
png('SF6.png', width=2048, height=1800, res=310)
plot(ARTnet.wide.adjusted$main.avgduration.yr, ARTnet.wide.adjusted$main.slope,
xlab="Average Duration of Main Relationships (Years)",
ylab="Difference in Degree of Main Relationships at 12- and 0-Month Offsets")
dev.off()
png('SF6.png', width=2048, height=1536, res=300)
plot(ARTnet.wide.adjusted$main.avgduration.yr, ARTnet.wide.adjusted$main.slope,
xlab="Average Duration of Main Relationships (Years)",
ylab="Difference in Degree of Main Relationships at 12- and 0-Month Offsets",
cex.axis = 5)
dev.off()
png('SF6.png', width=2048, height=1536, res=300)
plot(ARTnet.wide.adjusted$main.avgduration.yr, ARTnet.wide.adjusted$main.slope,
xlab="Average Duration of Main Relationships (Years)",
ylab="Difference in Degree of Main Relationships at 12- and 0-Month Offsets",
cex.lab = 1)
dev.off()
png('SF6.png', width=2048, height=1536, res=300)
plot(ARTnet.wide.adjusted$main.avgduration.yr, ARTnet.wide.adjusted$main.slope,
xlab="Average Duration of Main Relationships (Years)",
ylab="Difference in Degree of Main Relationships at 12- and 0-Month Offsets",
cex.lab = 0.75)
dev.off()
png('SF7.png', width=2048, height=1536, res=300)
plot(ARTnet.wide.adjusted$casl.avgduration.yr, ARTnet.wide.adjusted$casl.slope,
xlab="Average Duration of Casual Relationships (Years)",
ylab="Difference in Degree of Casual Relationships at 12- and 0-Month Offsets",
cex.lab = 0.75)
dev.off()
png('SF8.png', width=2048, height=1536, res=300)
plot(jitter(ARTnet.wide.adjusted$main.slope,0.1)~jitter(ARTnet.wide.adjusted$n.all, 0.1),
xlab="Total Number of Male Partners Reported",
ylab="Difference in Degree of Main Relationships at 12- and 0-Month Offsets",
cex.lab = 0.75)
dev.off()
png('SF9.png', width=2048, height=1536, res=300)
plot(ARTnet.wide.adjusted$main.slope~ARTnet.wide.adjusted$M_MP12OANUM2,
xlab="Total Number of Male Partners",
ylab="Difference in Degree of Main Relationships at 12- and 0-Month Offsets",
cex.lab = 0.75)
dev.off()
png('SF9.png', width=2048, height=1536, res=300)
plot(jitter(ARTnet.wide.adjusted$casl.slope,0.1)~jitter(ARTnet.wide.adjusted$n.all, 0.1),
xlab="Total Number of Male Partners Reported",
ylab="Difference in Degree of Casual Relationships at 12- and 0-Month Offsets",
cex.lab = 0.75)
dev.off()
png('SF9.png', width=2048, height=1536, res=300)
plot(jitter(ARTnet.wide.adjusted$casl.slope,0.1)~jitter(ARTnet.wide.adjusted$n.all, 0.1),
xlab="Total Number of Male Partners Reported",
ylab="Difference in Degree of Casual Relationships at 12- and 0-Month Offsets",
cex.lab = 0.75)
dev.off()
png('SF9.png', width=2048, height=1536, res=300)
plot(ARTnet.wide.adjusted$main.slope~ARTnet.wide.adjusted$M_MP12OANUM2,
xlab="Total Number of Male Partners",
ylab="Difference in Degree of Main Relationships at 12- and 0-Month Offsets",
cex.lab = 0.75)
dev.off()
png('SF10.png', width=2048, height=1536, res=300)
plot(jitter(ARTnet.wide.adjusted$casl.slope,0.1)~jitter(ARTnet.wide.adjusted$n.all, 0.1),
xlab="Total Number of Male Partners Reported",
ylab="Difference in Degree of Casual Relationships at 12- and 0-Month Offsets",
cex.lab = 0.75)
dev.off()
png('SF11.png', width=2048, height=1536, res=300)
plot(ARTnet.wide.adjusted$casl.slope~ARTnet.wide.adjusted$M_MP12OANUM2,
xlab="Total Number of Male Partners",
ylab="Difference in Degree of Main Relationships at 12- and 0-Month Offsets",
cex.lab = 0.75)
dev.off()
#using total number of partnerships reported
main.multiple.yr <- lm(main.slope ~ race.cat + age + main.avgduration.yr + n.all, data = ARTnet.wide.adjusted)
summary(main.multiple.yr)
round(confint(main.multiple.yr), 3)
#using total number of male partners
main.multiple.yr2 <- lm(main.slope ~ race.cat + age + main.avgduration.yr + M_MP12OANUM2, data = ARTnet.wide.adjusted)
summary(main.multiple.yr2)
round(confint(main.multiple.yr2), 3)
#using total number of partnerships reported
main.multiple.yr3 <- lm(main.slope ~ race.cat + age + main.avgduration.yr + n.all + factor(HHINCOME_2) + factor(HLEDUCAT_2) + factor(REGCODE), data = ARTnet.wide.adjusted)
summary(main.multiple.yr3)
round(confint(main.multiple.yr3), 3)
ARTnet.wide.adjusted$REGCODE
#using total number of partnerships reported
casl.multiple.yr <- lm(casl.slope ~ race.cat + age + casl.avgduration.yr + n.all, data = ARTnet.wide.adjusted)
summary(casl.multiple.yr)
round(confint(casl.multiple.yr), 3)
#using total number of male partners
casl.multiple.yr2 <- lm(casl.slope ~ race.cat + age + casl.avgduration.yr + M_MP12OANUM2, data = ARTnet.wide.adjusted)
summary(casl.multiple.yr2)
round(confint(casl.multiple.yr2), 3)
# Main slope outliers
ARTnet.wide.adjusted %>%
filter(!(main.slope %in% c(-1:1))) %>%
select(AMIS_ID, main.slope)
main.outliers <- ARTnet.long %>%
filter(AMIS_ID %in% c(2515935,3017617,27010355,2976652,32510928)) %>%
select(AMIS_ID, ptype, SUB_DATE, start.date.2, end.date.2, ONGOING) %>%
mutate(months.sub.start = (year(SUB_DATE) - year(start.date.2)) * 12 + month(SUB_DATE) - month(start.date.2),
months.sub.end = (year(SUB_DATE) - year(end.date.2)) * 12 + month(SUB_DATE) - month(end.date.2))
# Casual slope outliers
ARTnet.wide.adjusted %>%
filter(!(casl.slope %in% c(-3:3))) %>%
select(AMIS_ID, casl.slope) %>%
print(n=22)
casl.outliers <- ARTnet.long %>%
filter(AMIS_ID %in% c(2568904,26610093,2853178,263264,2997173)) %>%
select(AMIS_ID, ptype, SUB_DATE, start.date.2, end.date.2, ONGOING) %>%
mutate(months.sub.start = (year(SUB_DATE) - year(start.date.2)) * 12 + month(SUB_DATE) - month(start.date.2),
months.sub.end = (year(SUB_DATE) - year(end.date.2)) * 12 + month(SUB_DATE) - month(end.date.2))
install.packages("tidyverse")
renv::upgrade(version = "0.12.3")
renv::install("tidyr")
renv::restore()
install.packages(c("backports", "callr", "cli", "clipr", "colorspace", "cowplot", "dbplyr", "digest", "dplyr", "fs", "generics", "ggplot2", "haven", "htmltools", "httr", "isoband", "jsonlite", "kableExtra", "labeling", "lubridate", "magrittr", "MASS", "Matrix", "mgcv", "nlme", "pillar", "pkgbuild", "processx", "ps", "R6", "Rcpp", "readr", "rlang", "rmarkdown", "rprojroot", "rstudioapi", "rvest", "stringi", "testthat", "tibble", "tinytex", "vctrs", "withr", "xfun"))
install.packages(c("codetools", "foreign", "KernSmooth", "MASS", "Matrix", "mgcv", "nlme", "survival"), lib="C:/Users/clchand/AppData/Local/Temp/RtmpsFbyf3/renv-system-library")
## Load Data and Packages---------------------------------------------------------------------
library(ARTnetData, warn.conflicts=F, quietly=T)
library(dplyr, warn.conflicts=F, quietly=T)
library(knitr, warn.conflicts=F, quietly=T)
options(kableExtra.latex.load_packages = FALSE)
library(kableExtra, warn.conflicts=F, quietly=T)
library(lubridate)
library(gridExtra)
library(cowplot)
library(ggplot2)
installed.packages("rlang")
install.packages("rlang")
renv::snapshot()
install.packages("BH")
renv::snapshot()
## Load Data and Packages---------------------------------------------------------------------
library(ARTnetData, warn.conflicts=F, quietly=T)
library(dplyr, warn.conflicts=F, quietly=T)
library(knitr, warn.conflicts=F, quietly=T)
options(kableExtra.latex.load_packages = FALSE)
library(kableExtra, warn.conflicts=F, quietly=T)
library(lubridate)
library(gridExtra)
library(cowplot)
library(ggplot2)
# Load long data
ARTnet.long$ONGOING <- as.numeric(ARTnet.long$ONGOING)
# Randomly impute days (1-30) for start dates and end dates that are not equal to SUB_DATE
set.seed(12345)
ARTnet.long$start.date.2 <- ARTnet.long$start.date
ARTnet.long$end.date.2 <- ARTnet.long$end.date
for (i in 1:nrow(ARTnet.long)) {
day(ARTnet.long[i,"start.date.2"]) <- sample(1:30, size=1, replace = T)
day(ARTnet.long[i,"end.date.2"]) <- ifelse(day(ARTnet.long[i,"end.date"]) != day(ARTnet.long[i,"SUB_DATE"]),
sample(1:30, size=1, replace = T), day(ARTnet.long[i,"end.date.2"]))
}
summary(day(ARTnet.long$start.date.2))
summary(day(ARTnet.long$end.date.2))
# Create Variable 'Age.Cat' to Create Age Categories for Ages
ARTnet.wide$age.cat <- ifelse(ARTnet.wide$age >= 15 & ARTnet.wide$age <= 24, '15-24',
ifelse(ARTnet.wide$age >= 25 & ARTnet.wide$age <= 34, '25-34',
ifelse(ARTnet.wide$age >= 35 & ARTnet.wide$age <= 44, '35-44',
ifelse(ARTnet.wide$age >= 45 & ARTnet.wide$age <= 54, '45-54',
ifelse(ARTnet.wide$age >= 55 & ARTnet.wide$age <= 65, '55-65',
ifelse(ARTnet.wide$age >= 66, '66+', 'unknown'))))))
addmargins(table(ARTnet.wide$age.cat, useNA = 'always'))
# Race
addmargins(table(ARTnet.wide$race.cat, useNA = 'always'))
# Census region
addmargins(table(ARTnet.wide$REGCODE, useNA = 'always'))
# Census division
addmargins(table(ARTnet.wide$DIVCODE, useNA = 'always'))
ARTnet.wide$HLEDUCAT_2 <- ifelse(ARTnet.wide$HLEDUCAT <= 3, 0,
ifelse(ARTnet.wide$HLEDUCAT == 4, 1,
ifelse(ARTnet.wide$HLEDUCAT == 5, 2, NA)))
addmargins(table(ARTnet.wide$HLEDUCAT_2, useNA = 'always'))
# Income
addmargins(table(ARTnet.wide$HHINCOME, useNA = 'always'))
ARTnet.wide$HHINCOME_2 <- ifelse(ARTnet.wide$HHINCOME >= 77, NA, ARTnet.wide$HHINCOME)
addmargins(table(ARTnet.wide$HHINCOME_2, useNA = 'always'))
# Partnership type
addmargins(table(ARTnet.long$ptype, useNA = 'always'))
# Self-reported ongoing status
addmargins(table(ARTnet.long$ongoing, useNA = 'always'))
table(ARTnet.wide$PART1ONGOING)
table(ARTnet.long$ONGOING.orig)
table(ARTnet.long$ONGOING.orig, ARTnet.long$ONGOING)
# Self-reported ongoing status
addmargins(table(ARTnet.long$ONGOING, useNA = 'always'))
# Self-reported ongoing status
addmargins(table(ARTnet.long$ongoing, useNA = 'always'))
ARTnet.long$ongoing2 <- ifelse(is.na(ARTnet.long$ONGOING), 0, #set 3017 missing values to not ongoing
ARTnet.long$ONGOING)
# Self-reported ongoing status
addmargins(table(ARTnet.long$ongoing2, useNA = 'always'))
table(ARTnet.long$ONGOING.orig, ARTnet.long$ongoing2)
table(ARTnet.long$ONGOING.orig, ARTnet.long$ongoing2, useNA = "always")
temp_wide <- spread(ARTnet.long, ongoing2)
library(tidyverse, warn.conflicts=F, quietly=T)
install.packages(tidyr)
install.packages("tidry")
install.packages("tidyr")
## Load Data and Packages---------------------------------------------------------------------
library(ARTnetData, warn.conflicts=F, quietly=T)
library(dplyr, warn.conflicts=F, quietly=T)
library(knitr, warn.conflicts=F, quietly=T)
options(kableExtra.latex.load_packages = FALSE)
library(kableExtra, warn.conflicts=F, quietly=T)
library(lubridate)
library(gridExtra)
library(cowplot)
library(ggplot2)
# Load long data
ARTnet.long$ONGOING <- as.numeric(ARTnet.long$ONGOING)
ARTnet.long$ongoing2 <- ifelse(is.na(ARTnet.long$ONGOING), 0, #set 3017 missing values to not ongoing
ARTnet.long$ONGOING)
# Randomly impute days (1-30) for start dates and end dates that are not equal to SUB_DATE
set.seed(12345)
ARTnet.long$start.date.2 <- ARTnet.long$start.date
ARTnet.long$end.date.2 <- ARTnet.long$end.date
for (i in 1:nrow(ARTnet.long)) {
day(ARTnet.long[i,"start.date.2"]) <- sample(1:30, size=1, replace = T)
day(ARTnet.long[i,"end.date.2"]) <- ifelse(day(ARTnet.long[i,"end.date"]) != day(ARTnet.long[i,"SUB_DATE"]),
sample(1:30, size=1, replace = T), day(ARTnet.long[i,"end.date.2"]))
}
summary(day(ARTnet.long$start.date.2))
summary(day(ARTnet.long$end.date.2))
# Create Variable 'Age.Cat' to Create Age Categories for Ages
ARTnet.wide$age.cat <- ifelse(ARTnet.wide$age >= 15 & ARTnet.wide$age <= 24, '15-24',
ifelse(ARTnet.wide$age >= 25 & ARTnet.wide$age <= 34, '25-34',
ifelse(ARTnet.wide$age >= 35 & ARTnet.wide$age <= 44, '35-44',
ifelse(ARTnet.wide$age >= 45 & ARTnet.wide$age <= 54, '45-54',
ifelse(ARTnet.wide$age >= 55 & ARTnet.wide$age <= 65, '55-65',
ifelse(ARTnet.wide$age >= 66, '66+', 'unknown'))))))
addmargins(table(ARTnet.wide$age.cat, useNA = 'always'))
# Race
addmargins(table(ARTnet.wide$race.cat, useNA = 'always'))
# Census region
addmargins(table(ARTnet.wide$REGCODE, useNA = 'always'))
# Census division
addmargins(table(ARTnet.wide$DIVCODE, useNA = 'always'))
ARTnet.wide$HLEDUCAT_2 <- ifelse(ARTnet.wide$HLEDUCAT <= 3, 0,
ifelse(ARTnet.wide$HLEDUCAT == 4, 1,
ifelse(ARTnet.wide$HLEDUCAT == 5, 2, NA)))
addmargins(table(ARTnet.wide$HLEDUCAT_2, useNA = 'always'))
# Income
addmargins(table(ARTnet.wide$HHINCOME, useNA = 'always'))
ARTnet.wide$HHINCOME_2 <- ifelse(ARTnet.wide$HHINCOME >= 77, NA, ARTnet.wide$HHINCOME)
addmargins(table(ARTnet.wide$HHINCOME_2, useNA = 'always'))
# Partnership type
addmargins(table(ARTnet.long$ptype, useNA = 'always'))
# Self-reported ongoing status
addmargins(table(ARTnet.long$ongoing2, useNA = 'always'))
temp_wide <-
# Mean (SD) duration of partnership
mean(ARTnet.long$duration, na.rm = T)
sd(ARTnet.long$duration, na.rm = T)
??select
temp_wide <- select(ARTnet.long, AMIS_ID, PARTNER_ID, ongoing2)
View(temp_wide)
temp_long <- select(ARTnet.long, AMIS_ID, PARTNER_ID, ongoing2)
temp_wide <- reshape(temp_long, idvar = "AMIS_ID", timevar = "PARTNER_ID", direction = "wide")
View(temp_wide)
View(ARTnet.wide)
temp_wide <- ifelse(is.na(temp_wide), 0,
temp_wide)
View(temp_wide)
temp_long <- select(ARTnet.long, AMIS_ID, PARTNER_ID, ongoing2)
temp_wide <- reshape(temp_long, idvar = "AMIS_ID", timevar = "PARTNER_ID", direction = "wide")
temp_wide$ongoing2.1 <- ifelse(is.na(temp_wide$ongoing2.1), 0, temp_wide$ongoing2.1)
temp_wide$ongoing2.2 <- ifelse(is.na(temp_wide$ongoing2.2), 0, temp_wide$ongoing2.1)
temp_wide$ongoing2.3 <- ifelse(is.na(temp_wide$ongoing2.3), 0, temp_wide$ongoing2.1)
temp_wide$ongoing2.4 <- ifelse(is.na(temp_wide$ongoing2.4), 0, temp_wide$ongoing2.1)
temp_wide$ongoing2.5 <- ifelse(is.na(temp_wide$ongoing2.5), 0, temp_wide$ongoing2.1)
temp_long <- select(ARTnet.long, AMIS_ID, PARTNER_ID, ongoing2)
temp_wide <- reshape(temp_long, idvar = "AMIS_ID", timevar = "PARTNER_ID", direction = "wide")
temp_wide$ongoing2.1 <- ifelse(is.na(temp_wide$ongoing2.1), 0, temp_wide$ongoing2.1)
temp_wide$ongoing2.2 <- ifelse(is.na(temp_wide$ongoing2.2), 0, temp_wide$ongoing2.1)
temp_wide$ongoing2.3 <- ifelse(is.na(temp_wide$ongoing2.3), 0, temp_wide$ongoing2.1)
temp_wide$ongoing2.4 <- ifelse(is.na(temp_wide$ongoing2.4), 0, temp_wide$ongoing2.1)
temp_wide$ongoing2.5 <- ifelse(is.na(temp_wide$ongoing2.5), 0, temp_wide$ongoing2.1)
temp_wide$ongoing_all <- temp_wide$ongoing2.1 + temp_wide$ongoing2.2 + temp_wide$ongoing2.3 +
temp_wide$ongoing2.4 + temp_wide$ongoing2.5
table(temp_wide$ongoing_all)
left_join(ARTnet.wide, temp_wide, by = "AMIS_ID")
temp_wide2 <- left_join(ARTnet.wide, temp_wide, by = "AMIS_ID")
tables(temp_wide2$ongoing_all)
table(temp_wide2$ongoing_all)
addmargins(table(temp_wide2$ongoing_all, useNA = "always"))
addmargins(table(temp_wide$ongoing_all, useNA = "always"))
(205+1576)/4904*100
table(ARTnet.long$ptype, ARTnet.long$ongoing2)
temp_long <- ARTnet.long %>%
filter(ptype %in% c(1,2)) %>%
select(ARTnet.long, AMIS_ID, PARTNER_ID, ongoing2)
temp_long <- ARTnet.long %>%
filter(ptype %in% c(1,2)) %>%
select(ARTnet.long, AMIS_ID, PARTNER_ID, ongoing2)
temp_long <- ARTnet.long %>%
filter(ptype %in% c(1,2)) %>%
select(ARTnet.long, AMIS_ID, PARTNER_ID, ongoing2, ptype)
View(temp_long)
temp_long <- ARTnet.long %>%
filter(ptype %in% c(1,2)) %>%
select(AMIS_ID, PARTNER_ID, ongoing2)
temp_wide <- reshape(temp_long, idvar = "AMIS_ID", timevar = "PARTNER_ID", direction = "wide")
temp_wide$ongoing2.1 <- ifelse(is.na(temp_wide$ongoing2.1), 0, temp_wide$ongoing2.1)
temp_wide$ongoing2.2 <- ifelse(is.na(temp_wide$ongoing2.2), 0, temp_wide$ongoing2.1)
temp_wide$ongoing2.3 <- ifelse(is.na(temp_wide$ongoing2.3), 0, temp_wide$ongoing2.1)
temp_wide$ongoing2.4 <- ifelse(is.na(temp_wide$ongoing2.4), 0, temp_wide$ongoing2.1)
temp_wide$ongoing2.5 <- ifelse(is.na(temp_wide$ongoing2.5), 0, temp_wide$ongoing2.1)
temp_wide$ongoing_all <- temp_wide$ongoing2.1 + temp_wide$ongoing2.2 + temp_wide$ongoing2.3 +
temp_wide$ongoing2.4 + temp_wide$ongoing2.5
temp_wide2 <- left_join(ARTnet.wide, temp_wide, by = "AMIS_ID")
addmargins(table(temp_wide2$ongoing_all, useNA = "always"))
(310+247)/4904*100
addmargins(table(temp_long$ongoing2))
# Self-reported ongoing status
temp_long <- ARTnet.long %>%
filter(ptype %in% c(1,2)) %>%
select(AMIS_ID, PARTNER_ID, ongoing2, ptype)
addmargins(table(temp_long$ongoing2, temp_long))
addmargins(table(temp_long$ongoing2, temp_long$ptype))
renv::snapshot()
renv::snapshot()
## Load Data and Packages---------------------------------------------------------------------
library(ARTnetData, warn.conflicts=F, quietly=T)
library(dplyr, warn.conflicts=F, quietly=T)
library(knitr, warn.conflicts=F, quietly=T)
options(kableExtra.latex.load_packages = FALSE)
library(kableExtra, warn.conflicts=F, quietly=T)
library(lubridate)
library(gridExtra)
library(cowplot)
## Load Data and Packages---------------------------------------------------------------------
library(ARTnetData, warn.conflicts=F, quietly=T)
library(dplyr, warn.conflicts=F, quietly=T)
library(knitr, warn.conflicts=F, quietly=T)
options(kableExtra.latex.load_packages = FALSE)
library(kableExtra, warn.conflicts=F, quietly=T)
library(lubridate)
library(gridExtra)
library(cowplot)
library(ggplot2)
